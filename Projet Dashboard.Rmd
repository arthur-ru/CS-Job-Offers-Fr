---
title: "job offer per region"
output:
  flexdashboard::flex_dashboard:
    theme:
      bootswatch: flatly
    orientation: columns
    vertical_layout: fill
    source_code: embed
runtime: shiny
resource_files:
- data/finalData.csv
- departements/departements-20180101.cpg
- departements/departements-20180101.dbf
- departements/departements-20180101.prj
- departements/departements-20180101.shp
- departements/departements-20180101.shx
- logo.png

---


```{r setup, include=FALSE}
library(flexdashboard)
library(leaflet)
library(ggplot2)
library(maps)
library(readr)
library(dplyr)
library(ggmap)
library(tmaptools)
library(sf)
library(tidyr)
library(shiny)
library(plotly)

finalData <- read.csv("data/finalData.csv", dec=".", sep = ",")
dep_offers <- finalData$department
dep_offers_count <- table(dep_offers)
dep_offers_count <- as.data.frame(dep_offers_count)
names(dep_offers_count) <- c("num_dep", "nb_offers") 


france_departments <- st_read("departements/departements-20180101.shp")
france_departments$code_insee <- gsub("M", "", france_departments$code_insee)
france_departments$code_insee <- gsub("D", "", france_departments$code_insee)
france_departments$code_insee <- as.numeric(france_departments$code_insee)
france_departments <- subset(france_departments, code_insee <= 95)

france_departments <- merge(france_departments, dep_offers_count, by.x="code_insee", by.y="num_dep", all.x=TRUE)

# Fill NA values in nb_offers column with zeros
france_departments$nb_offers <- ifelse(is.na(france_departments$nb_offers), 0, france_departments$nb_offers)


```

# Présentation
## Column 1 {data-width=650}
### Présentation du sujet

Présentation du sujet bla bla bla


## Column 2 {data-width=350}

###
```{r}
fluidRow(
  column(width = 4, img(src = "logo.png", width = 350))
)
```



### Dashboard réalisé par :

<ul>
  <li>EL-OTHMANI Youssef</li>
  <li>FLANDRE Noe</li>
  <li>MICHELIN Marc-Alexandre</li>
  <li>RUBIO Arthur</li>
  <li>TERRASSON Ludovic</li>
</ul>


# Base de données
Column {.tabset}
-----------------------------------------------------------------------
### Données

```{r}
DT::datatable(finalData, 
              options = list( pageLength = 25, 
                              dom = 'Bfrtip', 
                              buttons = c('csv')),
              extensions = 'Buttons',
              height = 1000,
              width = 1000)

```

### Description des données

description bla bla bla

# Offres par département {data-navmenu=Visualisation}
```{r}

output$map <- renderLeaflet({
leaflet(data = france_departments) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  setView(lng = 2.2137, lat = 46.2276, zoom = 6) %>%
  addPolygons(
    fillColor = ~colorNumeric("YlOrRd", domain = france_departments$nb_offers)(nb_offers),
    color = "#BDBDC3",
    weight = 1,
    fillOpacity = 1,
    opacity = 1,
    smoothFactor = 0.7,
    popup = ~paste("Nombre d'offres dans ",nom, ": ", nb_offers)
  )
})

output$mapUI <- renderUI({
  leafletOutput("map", height = "500px")
})

# Call the UI output to render the map
uiOutput("mapUI")


```

# Compétences demandées {data-navmenu=Visualisation}
```{r}


```

# Salaires par départements {data-navmenu=Visualisation}
```{r}
selectInput("département", label = "Département",
            choices = unique(finalData$department), multiple = TRUE, selected = NULL)
renderPlotly({
  # Sous-ensemble des données selon les types de permis sélectionnés par l'utilisateur
  location_data <- finalData %>% filter(department %in% input$département)
# Tracer l'histogramme
ggplot(location_data, aes(x = salaire)) +
  geom_histogram(fill = "lightblue", color = "black", bins = 20) +
  labs(title = "Répartition des salaires par département",
       x = "salaire", y = "") +
  theme_minimal()
})
```

# Salaires par secteurs {data-navmenu=Visualisation}
```{r}
selectInput("secteur", label = "Secteur",
            choices = unique(finalData$secteur), multiple = TRUE, selected = NULL)
renderPlotly({
  # Sous-ensemble des données selon les types de permis sélectionnés par l'utilisateur
  secteur_data <- finalData %>% filter(secteur %in% input$secteur)
# Tracer l'histogramme
ggplot(secteur_data, aes(x = salaire)) +
  geom_histogram(fill = "lightblue", color = "black", bins = 20) +
  labs(title = "Répartition des salaires par secteur",
       x = "salaire", y = "") +
  theme_minimal()
})
```

# Matrice de corrélation {data-navmenu=Visualisation}
```{r}


```

## Column 1 {data-width=650}

# Conclusion

```{r}

```
